<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="jemdoc, see http://jemdoc.jaboc.net/" />
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="icon" href="./images/icon.png">
<link rel="stylesheet" href="main.css" type="text/css" />
<link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="font-awesome/css/all.css">
<!--- <title>Understanding Differential Flatness for Nonlinear Systems</title> --->
<title>Prasanth Kotaru</title>
<!-- MathJax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async>
</script>
<script src="https://kit.fontawesome.com/abe2951c4e.js" crossorigin="anonymous"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
	  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<!-- End MathJax -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CVL8023LDN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-CVL8023LDN');
</script>
<!-- Google tag (gtag.js) -->
</head>
<body>
<div id="main-container">
<div id="header-container">
<div id="header">
<div id="header-icon-text-container">
<div id="header-icon-container" >
<a href="index.html"><img src="./media/profile.jpg" alt="" style="width: 100%; height: 100%; position: center; padding:0px; margin: 0px;"></a>
</div>
<div id="header-text-container">
<a href="index.html">Prasanth Kotaru</a>
</div>
</div>
<div id="main">
<button class="openbtn" onclick="openNav()">☰</button>
</div>
</div>
</div>
<div id="layout">
<div id="layout-menu-container">
<div id="layout-menu">
<div class="menu-item"><a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a></div>
<div class="menu-item"><a href="index.html#about">About</a></div>
<div class="menu-item"><a href="index.html#publications">Publications</a></div>
<div class="menu-item"><a href="index.html#projects">Projects</a></div>
<div class="menu-item"><a href="index.html#contact">Contact</a></div>
<div class="menu-category"></div>
<div class="menu-item"><a href="posts.html">Posts</a></div>
<div class="menu-item"><a href="videos.html">Videos</a></div>
<div class="menu-item"><a href="gallery.html">Gallery</a></div>
<div class="menu-category"></div>
<div class="menu-item"><a href="https://github.com/vkotaru" target="blank">GitHub</a></div>
<div class="menu-item"><a href="https://scholar.google.com/citations?user=ZCumxcUAAAAJ&hl=en" target="blank">Google&nbsp;Scholar</a></div>
<div class="menu-item"><a href="https://www.linkedin.com/in/prasanthkotaru/" target="blank">LinkedIn</a></div>
<div class="menu-category"></div>
</div> <!-- <div id="layout-menu"> -->
</div> <!-- <div id="layout-menu-container"> -->
<div id="layout-content-container">
<div id="layout-content">
<div id="toptitle">
<h1>Understanding Differential Flatness for Nonlinear Systems</h1>
</div>
<p>The words &ldquo;<i>differential</i>&rdquo; and &ldquo;<i>flatness</i>&rdquo; together might sound a bit bizarre to the ear; 
however, they form an interesting concept in control theory. 
It is a property of certain nonlinear systems that makes it easier to work with these systems. 
In this post, I'll try to present an overview of differential flatness and how it is used for a couple of example systems. </p>
<p>The earliest references to differential flatness I came across are by Michel Fliess, Jean Lévine, Philippe Martin, Pierre Rouchon.</p>
<p><details>
<summary>Differential Flatness References</summary>
<ul>
<li>Fliess, Michel, Jean Lévine, Philippe Martin, and Pierre Rouchon. "On differentially flat nonlinear systems." In Nonlinear Control Systems Design 1992, pp. 159-163. Pergamon, 1993.</li>
<li>Pomet, J. B., C. H. Moog, and E. Aranda. "A non-exact Brunovsky form and dynamic feedback linearization." In [1992] Proceedings of the 31st IEEE Conference on Decision and Control, pp. 2012-2017. IEEE, 1992.</li>
<li>Fliess, Michel, Jean Lévine, Philippe Martin, and Pierre Rouchon. "Flatness and defect of non-linear systems: introductory theory and examples." International journal of control 61, no. 6 (1995): 1327-1361.</li>
<li>van Nieuwstadt, Michiel, Muruhan Rathinam, and Richard M. Murray. "Differential flatness and absolute equivalence." In Proceedings of 1994 33rd IEEE Conference on Decision and Control, vol. 1, pp. 326-332. IEEE, 1994.</li>
<li>Murray, Richard M., Muruhan Rathinam, and Willem Sluis. "Differential flatness of mechanical control systems: A catalog of prototype systems." In ASME international mechanical engineering congress and exposition. 1995.</li>
</ul>
</details></p>
<p>It says that all the states and the corresponding inputs for a nonlinear system can be computed from a 
finite set of variables (typically, less than the number of the original states) and 
their derivatives (up to a finite order) <u>without any integration</u>. 
These variables are called <b>flat outputs</b>.</p>
<div id="text-img-container"><div id="img-container">
<a href="./diff_flat.html"><img src="./media/diff_flat.png" alt="Differential_Flatness" width="280px" /></a></div>
<div id="text-container"><p><b>Definition</b>[1]: A system </p>
<p style="text-align:center">
\[
\begin{align}
\dot{x}=f(x,u), x\in \mathbb{R}^n, u\in \mathbb{R}^m
\end{align}
\]
</p><p>is differentially flat
if there exists flat outputs \(y\in \mathbb{R}^m\) of the form \(y=y(x,u,\dot u, \ddot{u}, &hellip;, u^{(p)})\)
such that the states and the inputs can be expressed as \(x=x(y, \dot{y}, &hellip;., y^{(q)})\), \(u = u(y, \dot y, &hellip;, y^{(q)})\), 
where \(p\), \(q\) are positive finite integers.</p>
<p>Note the number of flat outputs is equal to the number of inputs.</p>
</div></div>
<p>Let's look at an obvious example, a double integrator system.
The system equations for a double integrator can be written as,</p>
<p style="text-align:center">
\[
\begin{align}
\dot{x} &amp;=v\\
\dot{v} &amp;=u
\end{align}
\]
</p><p>For this system, \(x\) is a flat output, i.e., if we know \(x\) as a function of time, 
then its derivative would give us the \(v\), and the derivative of \(v\) is \(u\).
Therefore, knowing \(x\), \(\dot x\), \(\ddot x\), we can have the system states and inputs.
Note <u>without any integration</u> from earlier; if you know \(u\) as a function of time, 
integrating and double integrating would give the states and requires knowing the initial conditions.
Keep in mind it is <b>differentially flat</b> and <b>not integrally flat</b> ;).
A double integrator system is differentially flat system with \(x\) as the flat output.
This example is a bit trivial and might not give more insight into differential flatness.</p>
<p>Now, let's consider an example from [2], </p>
<p style="text-align:center">
\[
\begin{align}
\dot{x}_1 &amp;=x_3-x_2u\\
\dot{x}_2 &amp;=-x_2 + u \\
\dot{x}_3 &amp;=x_2 - x_1 + 2x_2(u-x_2)
\end{align}
\]
</p><p>For this system consider a flat output of the form \(y = x_1{ + }\frac{x_2^2}{2}\), taking it derivatives \(\dot y, \ddot y, y^{(3)}\) 
and solving for \(x_1, x_2, x_3\) gives the system states and inputs (see [2] for details).</p>
<p style="text-align:center">
\[
  \begin{align}
    x_1 =&amp; -(1+\ddot{y}) + \sqrt{1 + 2 {y} + 2\ddot{y}} \\
    x_2 =&amp; \ddot y + x_1 \\
    x_3 =&amp; \dot y + {\ddot y }^2 + 2x_1 \ddot y + x_1^2\\
    u = &amp; \frac{y^{(3)} + {\ddot y }^2+ \ddot y +\dot y + x_1 + 2x_1\ddot y+ x_1^2 }{1+ \ddot y + x_1}
  \end{align}
\]
</p><p>These equations seems way more complicated the original system equations in (4)-(6), why would I want to use them?
Well, keep in mind, equations (7)-(10) are just expressions for the states and inputs in terms of the flat output \(y\) and its derivatives. 
i.e., the whole system (4)-(6) behavior can be expressed using a single function \(y(t)\). </p>
<p>How do you make use of this information? You can plan for a desired system behavior by finding a suitable \(y(t)\) with the 
desired state conditions. For instance, find a \(t\) parameterized curve as,  </p>
<p style="text-align:center">
\[
 \begin{align}
  y = a_0 + a_1 t + a_2 t^ 2 + &hellip; + a_p t^p.
 \end{align} 
\]
</p><p>Knowing the desired \(y(t)\), you can find the corresponding system input \(u(t)\).
Alternatively, you can use differential flatness as an observer, i.e., by measuring \(y\) you can observe the system states and inputs.</p>
<p><b>Caveat</b>: Planning in the flat space is not always easy. Sometimes, it might be easier to plan using the full system equations than
planning using the flat outputs. It all depends on how complex and nonlinear the relation between the flat outputs and the system states and inputs is,
(7)-(10) for the above example.
In the above example, planning in the flat-space requires a curve parameterized in \(t\) that's atleast 3 times differentiable, i.e., \(y\in \mathcal{C}^3\).
Planning in \(y\) requires atleast a \(4^{th}\) order polynomial or using perodioc function as basis functions. 
Going more into detail requires a separate post, (see minimum snap/jerk trajectory planning if you are interested).
So, for systems that require higher flat-output derivatives (i.e., \(y^{(p)}\)), planning in the flat space might be difficult due to numerical 
instabilities and/or high computational cost as it requires \(p^{th}\) order polynomial fitting.</p>
<h3>Canonical Form</h3>
<p>The system in (1) can be expressed in a canonical form using the flat output \(y\) as,</p>
<p style="text-align:center">
\[
\begin{align}
\underbrace{\frac{d}{dt}\begin{bmatrix}y \\ \dot y \\ .\\ . \\ y^{(q-1)} \end{bmatrix}}_{\dot \xi} = 
\begin{bmatrix} 0 &amp; 1 &amp; 0 &amp; . &amp; 0\\
0 &amp; 0 &amp; 1 &amp; . &amp; 0\\
. &amp; . &amp; . &amp; . &amp; 0\\
0 &amp; 0 &amp; 0 &amp; . &amp; 1\\
0 &amp; 0 &amp; 0 &amp; . &amp; 0 \end{bmatrix}
\underbrace{\begin{bmatrix}y \\ \dot y \\ .\\ . \\ y^{(q-1)} \end{bmatrix} }_{\xi}
+ \begin{bmatrix} 0 \\ 0 \\ .\\ . \\ 1 \end{bmatrix} \underbrace{y^{(q)}}_{\nu}
\end{align}
\]
</p><p>the above equation is in the form \(\dot \xi = A \xi + B \nu\) with highest flat output derivative as the virtual input \(\nu\).
This is <a href="https://en.wikipedia.org/wiki/Feedback_linearization" target=&ldquo;blank&rdquo;>feedback linearization</a>.</p>
<p>For planning using the flat outputs, instead of finding a sufficiently smooth function for \(y(t)\), we can make use of the above canonical form
to find \(\nu(t)\) with necessary initial conditions.
Trajectory generation techniques like direct-collocation, single/multiple shooting methods 
can be used on the above linear system to find \(y\) and its derivatives.</p>
<p>I might have digressed a bit, but I hope you got the idea of how to use differential flatness for planning. 
The two earlier examples are a bit abstract in nature, let's look at a more tangile example next, 
differential flatness in quadrotors and how the states are computed from the flat variables.</p>
<h3>References</h3>
<ol>
<li><p>Murray, Richard M., Muruhan Rathinam, and Willem Sluis. &ldquo;Differential flatness of mechanical control systems: A catalog of prototype systems.&rdquo; In ASME international mechanical engineering congress and exposition. 1995.</p>
</li>
<li><p>Rigatos, Gerasimos G. &ldquo;Differential flatness theory and flatness-based control.&rdquo; In Nonlinear Control and Filtering Using Differential Flatness Approaches, pp. 47-101. Springer, Cham, 2015.</p>
</li>
</ol>
<script src="https://utteranc.es/client.js"
        repo="vkotaru/vkotaru.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div> <!-- <div id="layout-content"> -->
<div id="footer-container">
<div id="footer">
<div id="footer-text">
Last edited  on January 14<sup>th</sup> 2023  08:11AM (Time Zone: PST). </br>
Powered by <a href="https://github.com/szl2/jemdoc-new-design" target="blank">jemdoc + new design</a>.
</div> <!-- <div id="footer-text"> -->
</div> <!-- <div id="footer"> -->
</div> <!-- <div id="footer-container"> -->
</div> <!-- <div id="layout-content-container"> -->
</div> <!--- <div id="layout"> --->
</div> <!--- <div id="main-container"> --->
<script>
function openNav() {
    if (window.innerWidth <= 1200) {
        document.getElementById("layout-menu").style.width = "280px";
        document.getElementById("layout-content-container").style.marginLeft = "280.8px";
        document.getElementById("layout-content-container").style.position = "fixed";
    }
}
function closeNav() {
    if (window.innerWidth <= 1200) {
        document.getElementById("layout-menu").style.width = "0";
        document.getElementById("layout-content-container").style.position = "static";
        document.getElementById("layout-content-container").style.marginLeft = "0px";
        setInterval(
            function(){ location.reload() },
            500
        );
    }
}
</script>
</body>
</html>
